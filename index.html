<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fetch Data and MetaData from ARCGIS Online (AGOL) • fetchagol</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fetch Data and MetaData from ARCGIS Online (AGOL)">
<meta name="description" content="Reads data and metadata from an ARCGIS database.">
<meta property="og:description" content="Reads data and metadata from an ARCGIS database.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">fetchagol</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="fetchagol-readme">fetchagol README<a class="anchor" aria-label="anchor" href="#fetchagol-readme"></a>
</h1></div>
<p>2024-04-16</p>
<!-- badges: start -->

</div>
<div class="section level1">
<h1 id="about-this-package">About this package<a class="anchor" aria-label="anchor" href="#about-this-package"></a>
</h1>
<p>Add info</p>
<p>This R package pulls data from an ArcGIS Online (AGOL) database into RStudio. It uses the httr package to query the metadata and data from the AGOL database.</p>
</div>
<div class="section level1">
<h1 id="before-using-package">Before using package<a class="anchor" aria-label="anchor" href="#before-using-package"></a>
</h1>
<div class="section level2">
<h2 id="fill-out-metadata-in-agol-database">Fill out metadata in AGOL database<a class="anchor" aria-label="anchor" href="#fill-out-metadata-in-agol-database"></a>
</h2>
<p>For <strong>each of the tables</strong> in the database (not for the entire feature layer) you must fill out the Entity (table) and Attribute metadata. This is found in each table under <code>Metadata -&gt; All metadata -&gt; Attributes -&gt; Data Dictionary</code>. If using metadata editor classic it can be found under <code>Open in Metadata Editor Classic -&gt; Fields -&gt; Entity and Attribute Information -&gt; Entity and Attribute Details</code>. Here you must fill out the information for the table and each of the attributes in the table. See example below for help. If there is an attribute you don’t want imported into R, you can skip filling out its metadata.</p>
<p>Field Name, Field Alias, and Field Type can be found on the <code>Fields</code> tab of the <code>Data</code> section of each table in AGOL. Class is the EML type and must be specified in the Field Description. It can be a string, integer, decimal, or dateTime. For integer and decimal classes units should be provided. Standard EML units can be found <a href="https://sbclter.msi.ucsb.edu/external/InformationManagement/EDI/units/EML_units_preferred.html" class="external-link">here</a>. If you have a unit that isn’t found on the list, you can still use the unit and during the publication process described it as a “customUnit”.</p>
<div class="section level4">
<h4 id="metadata-examples">Metadata Examples<a class="anchor" aria-label="anchor" href="#metadata-examples"></a>
</h4>
<div class="section level5">
<h5 id="entity-example">Entity Example<a class="anchor" aria-label="anchor" href="#entity-example"></a>
</h5>
<p><img src="reference/figures/entityInfoExample.PNG" width="100%" alt="Screenshot of how to link a lookup table to an attribute"></p>
</div>
<div class="section level5">
<h5 id="string-example">String Example<a class="anchor" aria-label="anchor" href="#string-example"></a>
</h5>
<p><img src="reference/figures/attributeInfoExample1.PNG" width="100%" alt="Screenshot of how to link a lookup table to an attribute"></p>
</div>
<div class="section level5">
<h5 id="date-example">Date Example<a class="anchor" aria-label="anchor" href="#date-example"></a>
</h5>
<p><img src="reference/figures/attributeInfoExample3.PNG" width="100%" alt="Screenshot of how to link a lookup table to an attribute"></p>
</div>
<div class="section level5">
<h5 id="integer-example">Integer Example<a class="anchor" aria-label="anchor" href="#integer-example"></a>
</h5>
<p><img src="reference/figures/attributeInfoExample2.PNG" width="100%" alt="Screenshot of how to link a lookup table to an attribute"></p>
</div>
<div class="section level5">
<h5 id="double-example">Double Example<a class="anchor" aria-label="anchor" href="#double-example"></a>
</h5>
<p><img src="reference/figures/attributeInfoExample4.PNG" width="100%" alt="Screenshot of how to link a lookup table to an attribute"></p>
</div>
</div>
<div class="section level3">
<h3 id="lookup-tables">Lookup tables<a class="anchor" aria-label="anchor" href="#lookup-tables"></a>
</h3>
<p>If an attribute has a look up table it can be linked to the attribute. At the bottom of the information for the attribute select <code>Add section card -&gt; Codeset Domain</code>. Then enter the name of the lookup table and its link. The lookup table must have a <code>name</code> and <code>label</code> column to generate the metadata CSVs.</p>
<!-- ![Screenshot of how to link a lookup table to an attribute](man/figures/lookupTable.PNG) -->
<center>
<p><img src="reference/figures/lookupTable.PNG" width="70%" alt="Screenshot of how to link a lookup table to an attribute" class="center"></p>
</center>
</div>
<div class="section level3">
<h3 id="trouble-shooting-metadata">Trouble shooting metadata<a class="anchor" aria-label="anchor" href="#trouble-shooting-metadata"></a>
</h3>
<p>If the metadata is not filled out correctly the code will run into problems when importing or exporting the data and metadata.</p>
<div class="section level4">
<h4 id="trouble-shooting-when-importing-data">Trouble shooting when importing data<a class="anchor" aria-label="anchor" href="#trouble-shooting-when-importing-data"></a>
</h4>
<p>By default <code><a href="reference/fetchRawData.html">fetchRawData()</a></code> imports the metadata information and then queries the data using the metadata information. However, if the metadata is unable to import or if the metadata query has invalid parameters, the data will import independently. If this happens, there will either be A) no metadata or B) metadata that doesn’t match the data.</p>
<p>If no metadata imported most likely one (or more) of the tables in your database does not have the metadata filled out. Simply go to AGOL and fill out the metadata using the steps above.</p>
<p>If the metadata imported but the query failed, that means that there are differences between the metadata and data. Most likely this is a difference in column names between the two. This will have to be fixed by going into the metadata in AGOL and fixing the discrepancies. To find out where the differences are run <code><a href="reference/troubleshootMetadata.html">troubleshootMetadata()</a></code>. By default this returns a list where every element is a data frame containing data column names that don’t exist in the metadata and vice versa. See example below. It is fine if a column exists in the data table that doesn’t exist in the metadata (like <code>objectid</code> below). However, all metadata columns must exist in the data table. You can see in the example below there is an extra space in <code>globalid</code> in the metadata column name and an extra column called <code>visit</code>. To fix this go into the data table on AGOL, fix the differences, and re-import the data by running <code><a href="reference/fetchRawData.html">fetchRawData()</a></code> again.</p>
<center>
<p><img src="reference/figures/troubleshootExample.PNG" width="50%" alt="Screenshot showing output of troubleshootMetadata function" class="center"></p>
</center>
</div>
<div class="section level4">
<h4 id="trouble-shooting-when-writing-data">Trouble shooting when writing data<a class="anchor" aria-label="anchor" href="#trouble-shooting-when-writing-data"></a>
</h4>
<p>If the metadata imported and the data was imported by querying the metadata, there still might be problems in the metadata. There could be problems even if the data and metadata successfully write to CSVs. At this point the problems would probably be missing or incorrect metadata in a field other than the column name field such as definition, class, or unit. Running <code><a href="reference/troubleshootMetadata.html">troubleshootMetadata()</a></code> with the parameter <code>allInfo = TRUE</code> can help expose certain problems such as a missing definition, a non-valid class, or an integer or double with no unit. In the example below the data and metadata successfully wrote to CSVs. However, after running <code>troubleshootMetadata(all_data, allInfo = TRUE)</code> we can see that there is a missing definition, a non-valid metadata class, and an integer with a missing unit. To fix these problems go into the data table on AGOL, fix the problems, and re-import the data by running <code><a href="reference/fetchRawData.html">fetchRawData()</a></code> again.</p>
<center>
<p><img src="reference/figures/troubleshootExample2.PNG" width="75%" alt="Screenshot showing output of troubleshootMetadata function with allInfo set to TRUE" class="center"></p>
</center>
</div>
</div>
</div>
<div class="section level2">
<h2 id="setting-up-a-headless-account">Setting up a headless account<a class="anchor" aria-label="anchor" href="#setting-up-a-headless-account"></a>
</h2>
<p>To use the AGOL API you should have a headless account for scripting that has permission to access the AGOL database. It is recommended to save your headless account password using the <code>keyring</code> package to avoid hard coding your password into function. To add headless account information to the default keyring follow the steps below. The code should only have to be run once.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function below. Change the username field to the username of your headless account and input the password when prompted</span></span>
<span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_set</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"AGOL"</span>, username <span class="op">=</span> <span class="st">"USERNAME"</span>, prompt <span class="op">=</span> <span class="st">"Password for headless account: "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To check the key was saved run code below, filling in the username to your headless account</span></span>
<span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"AGOL"</span>, username <span class="op">=</span> <span class="st">"USERNAME"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>CC0</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fetchagol</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sarah Wright <br><small class="roles"> Author, maintainer </small>   </li>
<li>Irene Foster <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-9681-4786" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/nationalparkservice/imd-fetchagol-package/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/nationalparkservice/imd-fetchagol-package/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sarah Wright, Irene Foster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
